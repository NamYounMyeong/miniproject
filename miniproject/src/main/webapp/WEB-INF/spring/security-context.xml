<?xml version="1.0" encoding="UTF-8"?>
<beans:beans xmlns="http://www.springframework.org/schema/security"
    xmlns:beans="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.springframework.org/schema/beans 
    https://www.springframework.org/schema/beans/spring-beans.xsd
    http://www.springframework.org/schema/security 
    http://www.springframework.org/schema/security/spring-security.xsd">
    
    <beans:bean class="org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder" id="bcryptPasswordEncoder"/>
	<beans:bean class="com.iit.mp.security.CustomUserDetailsService" id="customUserDetailsService"/>
    
    <!-- http 태그는 경로를 매핑하여 필터체인의 실행여부를 설정 -->
    <!-- 체인은 위에서 아래로 진행되기 때문에 인증 예외 경로를 제외한 나머지 경로는 가장 아래 필터가 적용된다 -->
    <http pattern="/resources/**" security="none"></http>
    <!-- auto-config 속성을 true로 하면 필터체인의 default값이 설정된다. use-expressions 는 spEL 문법의 사용여부 설정 (spEL = 스프링 표현언어 Spring Expression Language)-->
    <http auto-config="true" use-expressions="true">
    	<csrf disabled="true"/>
    	<!-- /board 라는 경로를 가진 페이지들은 ROLE-USER라는 권한이 있어야 접근이 가능하다 -->
        <intercept-url pattern="/board/**" access="isAuthenticated()"/>
        <http-basic/> <!-- basic authentication 설정 (기본 인증) -->
        <!-- default-target-url = 로그인 성공 후 이동할 페이지 설정 -->
        <form-login login-page="/login" login-processing-url="/login" default-target-url="/board/board" username-parameter="mbrId" password-parameter="mbrPw"/>
        <logout logout-url="/logout" logout-success-url="/" delete-cookies="JSESSIONID"/>
        <!-- 자동 로그인 설정 (7일 = 604800초)-->
		<remember-me data-source-ref="dataSource" remember-me-parameter="remember-me" token-validity-seconds="604800"/>
    </http>

    <authentication-manager>
		<authentication-provider user-service-ref="customUserDetailsService">
			<password-encoder ref="bcryptPasswordEncoder"/>
		</authentication-provider>
    </authentication-manager>

</beans:beans>